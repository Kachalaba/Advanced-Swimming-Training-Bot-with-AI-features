# üé• Video Analysis Module

–ú–æ–¥—É–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –≤–∏–¥–µ–æ —Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –ø–æ –ø–ª–∞–≤–∞–Ω–∏—é.

## üöÄ –§—É–Ω–∫—Ü–∏–∏

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

1. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–∞–¥—Ä–æ–≤** (`frame_extractor.py`)
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç –∫–∞–¥—Ä—ã –∏–∑ –≤–∏–¥–µ–æ (MP4)
   - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è —á–∞—Å—Ç–æ—Ç–∞ (FPS)
   - –ú–∞–∫—Å. –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 60 —Å–µ–∫

2. **–î–µ—Ç–µ–∫—Ü–∏—è –ø–ª–æ–≤—Ü–∞** (`swimmer_detector.py`)
   - YOLO v8 –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–ª–æ–≤—Ü–∞
   - –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –∫–∞–∂–¥–æ–º –∫–∞–¥—Ä–µ
   - –û—Ü–µ–Ω–∫–∞ –Ω–æ–º–µ—Ä–∞ –¥–æ—Ä–æ–∂–∫–∏
   - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å bounding boxes

3. **–ê–Ω–∞–ª–∏–∑ —Å–ø–ª–∏—Ç–æ–≤** (`split_analyzer.py`)
   - –î–µ—Ç–µ–∫—Ü–∏—è –∫–∞—Å–∞–Ω–∏–π —Å—Ç–µ–Ω–∫–∏
   - –†–∞—Å—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –æ—Ç—Ä–µ–∑–∫–∞—Ö
   - –û—Ü–µ–Ω–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏
   - –ü–æ–¥—Å—á—ë—Ç —á–∞—Å—Ç–æ—Ç—ã –≥—Ä–µ–±–∫–æ–≤

4. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤** (`report_generator.py`)
   - –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Ä–µ–∑—é–º–µ (—Ç—Ä–µ–Ω–µ—Ä/–∞—Ç–ª–µ—Ç)
   - –ì—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
   - PDF –æ—Ç—á—ë—Ç—ã
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

5. **Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** (`handlers/video_analysis.py`)
   - –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ —á–µ—Ä–µ–∑ –±–æ—Ç–∞
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
   - –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r video_analysis/requirements.txt

# –°–∫–∞—á–∞—Ç—å YOLO –º–æ–¥–µ–ª—å (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ)
```

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ß–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞:

```
/analyze_video
‚Üí –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ
‚Üí –ü–æ–ª—É—á–∏—Ç—å –∞–Ω–∞–ª–∏–∑
```

### –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ:

```python
from video_analysis.frame_extractor import extract_frames_from_video
from video_analysis.swimmer_detector import detect_swimmer_in_frames
from video_analysis.split_analyzer import analyze_swimming_video
from video_analysis.report_generator import ReportGenerator

# 1. –ò–∑–≤–ª–µ—á—å –∫–∞–¥—Ä—ã
frames = extract_frames_from_video("video.mp4", fps=2)

# 2. –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–ª–æ–≤—Ü–∞
detections = detect_swimmer_in_frames(frames["frames"])

# 3. –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å
analysis = analyze_swimming_video(detections["detections"])

# 4. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—á—ë—Ç
generator = ReportGenerator()
report = generator.generate_complete_report(analysis, "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤")
```

## üìä –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

### –ê–Ω–∞–ª–∏–∑:
```json
{
  "summary": {
    "total_distance_m": 50.0,
    "total_time_s": 28.5,
    "average_speed_mps": 1.75,
    "average_pace_per_100m": 57.0
  },
  "stroke_rate_spm": 55.2,
  "splits": [
    {
      "split_number": 1,
      "time_seconds": 14.0,
      "speed_mps": 1.79
    },
    {
      "split_number": 2,
      "time_seconds": 14.5,
      "speed_mps": 1.72
    }
  ]
}
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—É–ª–∞:
```python
analyzer = SplitAnalyzer(
    pool_length=25.0,  # –º–µ—Ç—Ä–æ–≤
    fps=2.0,           # –∫–∞–¥—Ä–æ–≤/—Å–µ–∫
)
```

### –¢–æ—á–Ω–æ—Å—Ç—å –¥–µ—Ç–µ–∫—Ü–∏–∏:
```python
detector = SwimmerDetector(
    model_name="yolov8n.pt",  # n/s/m/l/x
)
```

## üìà Roadmap

### –°–ª–µ–¥—É—é—â–∏–µ —Ñ–∏—á–∏:

1. **–í–∏–¥–µ–æ-–æ–≤–µ—Ä–ª–µ–∏** 
   - –ê–Ω–∏–º–∞—Ü–∏—è –æ—à–∏–±–æ–∫ –ø—Ä—è–º–æ –≤ –≤–∏–¥–µ–æ
   - –¢—Ä–∞–µ–∫—Ç–æ—Ä–∏—è –¥–≤–∏–∂–µ–Ω–∏—è
   
2. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å —ç—Ç–∞–ª–æ–Ω–æ–º**
   - –ó–∞–≥—Ä—É–∑–∫–∞ —ç—Ç–∞–ª–æ–Ω–Ω–æ–≥–æ –≤–∏–¥–µ–æ
   - –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Ö–Ω–∏–∫–∏
   
3. **Google Sheets –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
   - –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   - –ò—Å—Ç–æ—Ä–∏—è –∞–Ω–∞–ª–∏–∑–æ–≤
   
4. **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å–æ–≤–µ—Ç—ã**
   - –ü–æ —É—Ä–æ–≤–Ω—é –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏
   - –ü–æ –≤–æ–∑—Ä–∞—Å—Ç—É –∞—Ç–ª–µ—Ç–∞
   
5. **API –¥–ª—è –∫–ª—É–±–æ–≤**
   - –ú–∞—Å—Å–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
   - –ì—Ä—É–ø–ø–æ–≤—ã–µ –æ—Ç—á—ë—Ç—ã

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –¢–µ—Å—Ç –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–∞–¥—Ä–æ–≤
python video_analysis/frame_extractor.py

# –¢–µ—Å—Ç –¥–µ—Ç–µ–∫—Ü–∏–∏
python video_analysis/swimmer_detector.py

# –¢–µ—Å—Ç –∞–Ω–∞–ª–∏–∑–∞
python video_analysis/split_analyzer.py

# –¢–µ—Å—Ç –æ—Ç—á—ë—Ç–æ–≤
python video_analysis/report_generator.py
```

## üìù –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –≤–∏–¥–µ–æ

- **–§–æ—Ä–º–∞—Ç:** MP4, MOV
- **–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –¥–æ 60 —Å–µ–∫
- **–ö–∞—á–µ—Å—Ç–≤–æ:** 720p+
- **–†–∞–∫—É—Ä—Å:** —Å–±–æ–∫—É –∏–ª–∏ —Å–≤–µ—Ä—Ö—É
- **–û—Å–≤–µ—â–µ–Ω–∏–µ:** —Ö–æ—Ä–æ—à–µ–µ
- **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:** –±–µ–∑ —Ç—Ä—è—Å–∫–∏

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–∞–¥—Ä–æ–≤:** ~5 —Å–µ–∫ / 60s –≤–∏–¥–µ–æ
- **–î–µ—Ç–µ–∫—Ü–∏—è:** ~1 —Å–µ–∫ / –∫–∞–¥—Ä
- **–ê–Ω–∞–ª–∏–∑:** ~2 —Å–µ–∫
- **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞:** ~3 —Å–µ–∫
- **–ò—Ç–æ–≥–æ:** ~2 –º–∏–Ω –Ω–∞ 60s –≤–∏–¥–µ–æ

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- Temp —Ñ–∞–π–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è
- –í–∏–¥–µ–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–º. docstrings –≤ –∫–∞–∂–¥–æ–º –º–æ–¥—É–ª–µ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π API.

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–°–æ–∑–¥–∞–Ω–æ:** 20 –Ω–æ—è–±—Ä—è 2025
